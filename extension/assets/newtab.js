import{_ as be,u as Te,s as Be,o as ge,A as ke,n as c,c as h,b,F as Ce,d as r,e as xe,f as n,g as we,h as y,i as ye,j as T,B as _e,p as De,k as Me,l as Ee,C as Se,I as $e,H as Fe,w as Ae,t as Ie,T as Ne,D as Ue,r as o,q as Le,m as Pe,v as Re,x as He,y as Ve,z as je}from"./shared-extensionBookmarkStore.js";const Oe={class:"newtab-container min-h-screen flex flex-col bg-bg-primary text-text-primary"},ze={key:0,class:"flex-1 flex items-center justify-center"},qe={class:"flex-1 flex items-start justify-center p-6 pb-20 pt-8"},Ge={class:"flex items-start gap-8"},Je={class:"mb-4"},Ke={key:0,class:"flex flex-col gap-4"},Qe={key:0,class:"fixed bottom-6 left-1/2 -translate-x-1/2 z-50 px-4 py-2 rounded-lg bg-bg-secondary ring-1 ring-neon-cyan/50 shadow-lg shadow-neon-cyan/20 text-sm text-text-primary"},We={__name:"NewTabApp",setup(Ze){const a=Te(),{activeBlocks:A,activeTab:u,activeTabId:I,sortedTabs:_,canAddTab:N,canDeleteTab:U,buffer:B,trash:D,trashBlockCount:ea,trashTabCount:L,tabs:P}=Be(a),{startDragFromBuffer:R,draggedFromBuffer:H}=He(),{copy:V,cut:j}=Re(),{isEditMode:m}=Le(),M=o(!0),v=o(!1),l=o(null),d=o(null),f=o(!1),s=o(!1),i=o({title:"",message:"",confirmText:"Подтвердить",danger:!1,onConfirm:()=>{}}),g=o(!1),k=o(!1),C=o(null),E=o(""),x=o(!1);let w=null;function O(e){E.value=e,x.value=!0,w&&clearTimeout(w),w=setTimeout(()=>{x.value=!1},2e3)}const z=Pe(()=>({tabs:P.value,buffer:B.value,trash:D.value}));ge(async()=>{await a.init(),M.value=!1,window.addEventListener("beforeunload",S),document.addEventListener("visibilitychange",$)});function S(){a.flushPendingSaves()}function $(){document.visibilityState==="hidden"&&a.flushPendingSaves()}ke(()=>{window.removeEventListener("beforeunload",S),document.removeEventListener("visibilitychange",$)});function q(e){m.value&&(l.value=null,d.value=e,f.value=!1,v.value=!0)}function G(e){m.value?(l.value=e,d.value=e.position,f.value=!1,v.value=!0):window.open(e.url,"_blank")}function J({block:e,tabId:t}){B.value.length>=12||a.moveToBuffer(t,e.id)}function K({block:e,tabId:t}){a.deleteBlock(t,e.id)}function Q({block:e}){O(`Ссылка скопирована: ${e.title}`)}function W(e){l.value?f.value?a.updateBufferBlock(l.value.id,e):a.updateBlock(u.value.id,l.value.id,e):a.addBlock(u.value.id,d.value,e),v.value=!1,l.value=null,d.value=null,f.value=!1}function X(){l.value&&(i.value={title:"Удалить закладку",message:`Вы уверены, что хотите удалить "${l.value.title}"?`,confirmText:"Удалить",danger:!0,onConfirm:()=>{f.value?a.deleteFromBuffer(l.value.id):a.deleteBlock(u.value.id,l.value.id),v.value=!1,s.value=!1,l.value=null,d.value=null,f.value=!1}},s.value=!0)}function Y(){v.value=!1,l.value=null,d.value=null,f.value=!1}function Z(e){a.setActiveTab(e)}function ee(){const e=a.addTab();e&&(C.value=e.id)}function ae(){C.value=null}function te({id:e,name:t}){a.updateTab(e,{name:t})}function le(e){const t=_.value.find(p=>p.id===e);t&&(i.value={title:"Удалить вкладку",message:`Вы уверены, что хотите удалить "${t.name}"? Все закладки этой вкладки будут перемещены в корзину.`,confirmText:"Удалить",danger:!0,onConfirm:()=>{a.deleteTab(e),s.value=!1}},s.value=!0)}function ne({fromIndex:e,toIndex:t}){a.reorderTabs(e,t)}function oe(e){R(e)}function se(e){u.value&&a.moveToBuffer(u.value.id,e.id)}function ue(e){l.value=e,d.value=null,f.value=!0,v.value=!0}function ie({block:e}){V(e,null,!0)}function re({block:e}){j(e,null,!0)}function de({block:e}){a.deleteFromBuffer(e.id)}function fe({trashIndex:e}){a.restoreBlockToBuffer(e)}function ce(e){H.value?a.deleteFromBuffer(e.id):u.value&&a.deleteBlock(u.value.id,e.id)}function ve(){i.value={title:"Очистить корзину",message:"Вы уверены, что хотите безвозвратно удалить все элементы из корзины? Это действие нельзя отменить.",confirmText:"Очистить",danger:!0,onConfirm:()=>{a.emptyTrash(),s.value=!1}},s.value=!0}function me(){g.value=!0}function pe(e){a.importData(e)}function he(){i.value={title:"Сбросить все данные",message:"Вы уверены, что хотите сбросить все данные? Все ваши закладки, вкладки и настройки будут удалены. Это действие нельзя отменить.",confirmText:"Сбросить всё",danger:!0,onConfirm:()=>{a.reset(),s.value=!1}},s.value=!0}return(e,t)=>(c(),h("div",Oe,[M.value?(c(),h("div",ze,[...t[4]||(t[4]=[b("div",{class:"text-text-secondary"},"Загрузка...",-1)])])):(c(),h(Ce,{key:1},[r(xe,{onOpenImportExport:me,onResetAll:he,onOpenHelp:t[0]||(t[0]=p=>k.value=!0)}),b("main",qe,[b("div",Ge,[b("div",null,[b("div",Je,[r(we,{tabs:n(_),"active-tab-id":n(I),"can-add-tab":n(N),"can-delete-tab":n(U),"edit-mode":n(m),"new-tab-id":C.value,onSelect:Z,onCreate:ee,onUpdate:te,onDelete:le,onReorder:ne,onEditComplete:ae},null,8,["tabs","active-tab-id","can-add-tab","can-delete-tab","edit-mode","new-tab-id"])]),n(u)?(c(),y(ye,{key:0,blocks:n(A),"tab-id":n(u).id,"edit-mode":n(m),onCellClick:q,onBlockClick:G,onMoveToBuffer:J,onMoveToTrash:K,onUrlCopied:Q},null,8,["blocks","tab-id","edit-mode"])):T("",!0)]),n(m)?(c(),h("div",Ke,[r(_e,{blocks:n(B),onBlockDragStart:oe,onDrop:se,onDropFromTrash:fe,onBlockClick:ue,onCopy:ie,onCut:re,onMoveToTrash:de},null,8,["blocks"]),r(De)])):T("",!0)])]),n(m)?(c(),y(Me,{key:0,"trash-blocks":n(D).blocks,"trash-tab-count":n(L),onTrashDrop:ce,onTrashEmpty:ve},null,8,["trash-blocks","trash-tab-count"])):T("",!0),r(Ee,{show:v.value,block:l.value,position:d.value,onSave:W,onDelete:X,onCancel:Y},null,8,["show","block","position"]),r(Se,{show:s.value,title:i.value.title,message:i.value.message,"confirm-text":i.value.confirmText,danger:i.value.danger,onConfirm:i.value.onConfirm,onCancel:t[1]||(t[1]=p=>s.value=!1)},null,8,["show","title","message","confirm-text","danger","onConfirm"]),r($e,{show:g.value,"current-data":z.value,onClose:t[2]||(t[2]=p=>g.value=!1),onImport:pe},null,8,["show","current-data"]),r(Fe,{show:k.value,onClose:t[3]||(t[3]=p=>k.value=!1)},null,8,["show"]),(c(),y(Ue,{to:"body"},[r(Ne,{name:"toast"},{default:Ae(()=>[x.value?(c(),h("div",Qe,Ie(E.value),1)):T("",!0)]),_:1})]))],64))]))}},Xe=be(We,[["__scopeId","data-v-444e989d"]]),F=Ve(Xe),Ye=je();F.use(Ye);F.mount("#app");
