import{_ as he,u as Te,s as Be,o as ge,D as ke,n as c,c as b,b as h,F as Ce,d as r,e as xe,f as o,g as we,h as y,i as ye,j as T,B as _e,p as De,k as Me,l as Ee,C as Ae,I as Se,H as $e,w as Fe,t as Ie,T as Ne,E as Ue,r as n,q as Le,m as Pe,v as Re,x as He,y as Ve,z as je,A as Oe}from"./shared-extensionBookmarkStore.js";const ze={class:"newtab-container min-h-screen flex flex-col bg-bg-primary text-text-primary"},qe={key:0,class:"flex-1 flex items-center justify-center"},Ge={class:"flex-1 flex items-start justify-center p-6 pb-20 pt-8"},Je={class:"flex items-start gap-8"},Ke={class:"mb-4"},Qe={key:0,class:"flex flex-col gap-4"},We={key:0,class:"fixed bottom-6 left-1/2 -translate-x-1/2 z-50 px-4 py-2 rounded-lg bg-bg-secondary ring-1 ring-neon-cyan/50 shadow-lg shadow-neon-cyan/20 text-sm text-text-primary"},Xe={__name:"NewTabApp",setup(ea){const a=Te();Ve("bookmarkStore",a);const{activeBlocks:F,activeTab:i,activeTabId:I,sortedTabs:_,canAddTab:N,canDeleteTab:U,buffer:B,trash:D,trashBlockCount:aa,trashTabCount:L,tabs:P}=Be(a),{startDragFromBuffer:R,draggedFromBuffer:H}=He(),{copy:V,cut:j}=Re(),{isEditMode:m}=Le(),M=n(!0),v=n(!1),l=n(null),d=n(null),f=n(!1),s=n(!1),u=n({title:"",message:"",confirmText:"Подтвердить",danger:!1,onConfirm:()=>{}}),g=n(!1),k=n(!1),C=n(null),E=n(""),x=n(!1);let w=null;function O(e){E.value=e,x.value=!0,w&&clearTimeout(w),w=setTimeout(()=>{x.value=!1},2e3)}const z=Pe(()=>({tabs:P.value,buffer:B.value,trash:D.value}));ge(async()=>{await a.init(),M.value=!1,window.addEventListener("beforeunload",A),document.addEventListener("visibilitychange",S)});function A(){a.flushPendingSaves()}function S(){document.visibilityState==="hidden"&&a.flushPendingSaves()}ke(()=>{window.removeEventListener("beforeunload",A),document.removeEventListener("visibilitychange",S)});function q(e){m.value&&(l.value=null,d.value=e,f.value=!1,v.value=!0)}async function G(e){m.value?(l.value=e,d.value=e.position,f.value=!1,v.value=!0):(await a.rememberActiveTab(),window.location.href=e.url)}function J({block:e,tabId:t}){B.value.length>=12||a.moveToBuffer(t,e.id)}function K({block:e,tabId:t}){a.deleteBlock(t,e.id)}function Q({block:e}){a.rememberActiveTab(),O(`Ссылка скопирована: ${e.title}`)}function W(e){l.value?f.value?a.updateBufferBlock(l.value.id,e):a.updateBlock(i.value.id,l.value.id,e):a.addBlock(i.value.id,d.value,e),v.value=!1,l.value=null,d.value=null,f.value=!1}function X(){l.value&&(u.value={title:"Удалить закладку",message:`Вы уверены, что хотите удалить "${l.value.title}"?`,confirmText:"Удалить",danger:!0,onConfirm:()=>{f.value?a.deleteFromBuffer(l.value.id):a.deleteBlock(i.value.id,l.value.id),v.value=!1,s.value=!1,l.value=null,d.value=null,f.value=!1}},s.value=!0)}function Y(){v.value=!1,l.value=null,d.value=null,f.value=!1}function Z(e){a.setActiveTab(e),a.rememberActiveTab()}function ee(){const e=a.addTab();e&&(C.value=e.id)}function ae(){C.value=null}function te({id:e,name:t}){a.updateTab(e,{name:t})}function le(e){const t=_.value.find(p=>p.id===e);t&&(u.value={title:"Удалить вкладку",message:`Вы уверены, что хотите удалить "${t.name}"? Все закладки этой вкладки будут перемещены в корзину.`,confirmText:"Удалить",danger:!0,onConfirm:()=>{a.deleteTab(e),s.value=!1}},s.value=!0)}function oe({fromIndex:e,toIndex:t}){a.reorderTabs(e,t)}function ne(e){R(e)}function se(e){i.value&&a.moveToBuffer(i.value.id,e.id)}function ie(e){l.value=e,d.value=null,f.value=!0,v.value=!0}function ue({block:e}){V(e,null,!0)}function re({block:e}){j(e,null,!0)}function de({block:e}){a.deleteFromBuffer(e.id)}function fe({trashIndex:e}){a.restoreBlockToBuffer(e)}function ce(e){H.value?a.deleteFromBuffer(e.id):i.value&&a.deleteBlock(i.value.id,e.id)}function ve(){u.value={title:"Очистить корзину",message:"Вы уверены, что хотите безвозвратно удалить все элементы из корзины? Это действие нельзя отменить.",confirmText:"Очистить",danger:!0,onConfirm:()=>{a.emptyTrash(),s.value=!1}},s.value=!0}function me(){g.value=!0}function pe(e){a.importData(e)}function be(){u.value={title:"Сбросить все данные",message:"Вы уверены, что хотите сбросить все данные? Все ваши закладки, вкладки и настройки будут удалены. Это действие нельзя отменить.",confirmText:"Сбросить всё",danger:!0,onConfirm:()=>{a.reset(),s.value=!1}},s.value=!0}return(e,t)=>(c(),b("div",ze,[M.value?(c(),b("div",qe,[...t[4]||(t[4]=[h("div",{class:"text-text-secondary"},"Загрузка...",-1)])])):(c(),b(Ce,{key:1},[r(xe,{onOpenImportExport:me,onResetAll:be,onOpenHelp:t[0]||(t[0]=p=>k.value=!0)}),h("main",Ge,[h("div",Je,[h("div",null,[h("div",Ke,[r(we,{tabs:o(_),"active-tab-id":o(I),"can-add-tab":o(N),"can-delete-tab":o(U),"edit-mode":o(m),"new-tab-id":C.value,onSelect:Z,onCreate:ee,onUpdate:te,onDelete:le,onReorder:oe,onEditComplete:ae},null,8,["tabs","active-tab-id","can-add-tab","can-delete-tab","edit-mode","new-tab-id"])]),o(i)?(c(),y(ye,{key:0,blocks:o(F),"tab-id":o(i).id,"edit-mode":o(m),onCellClick:q,onBlockClick:G,onMoveToBuffer:J,onMoveToTrash:K,onUrlCopied:Q},null,8,["blocks","tab-id","edit-mode"])):T("",!0)]),o(m)?(c(),b("div",Qe,[r(_e,{blocks:o(B),onBlockDragStart:ne,onDrop:se,onDropFromTrash:fe,onBlockClick:ie,onCopy:ue,onCut:re,onMoveToTrash:de},null,8,["blocks"]),r(De)])):T("",!0)])]),o(m)?(c(),y(Me,{key:0,"trash-blocks":o(D).blocks,"trash-tab-count":o(L),onTrashDrop:ce,onTrashEmpty:ve},null,8,["trash-blocks","trash-tab-count"])):T("",!0),r(Ee,{show:v.value,block:l.value,position:d.value,onSave:W,onDelete:X,onCancel:Y},null,8,["show","block","position"]),r(Ae,{show:s.value,title:u.value.title,message:u.value.message,"confirm-text":u.value.confirmText,danger:u.value.danger,onConfirm:u.value.onConfirm,onCancel:t[1]||(t[1]=p=>s.value=!1)},null,8,["show","title","message","confirm-text","danger","onConfirm"]),r(Se,{show:g.value,"current-data":z.value,onClose:t[2]||(t[2]=p=>g.value=!1),onImport:pe},null,8,["show","current-data"]),r($e,{show:k.value,onClose:t[3]||(t[3]=p=>k.value=!1)},null,8,["show"]),(c(),y(Ue,{to:"body"},[r(Ne,{name:"toast"},{default:Fe(()=>[x.value?(c(),b("div",We,Ie(E.value),1)):T("",!0)]),_:1})]))],64))]))}},Ye=he(Xe,[["__scopeId","data-v-dd5a87c0"]]),$=je(Ye),Ze=Oe();$.use(Ze);$.mount("#app");
