import{_ as Ee,u as De,s as Me,a as Ae,r as l,o as Se,E as Fe,p as u,c as p,d as T,F as Ie,e as r,f as Le,g as n,h as $e,i as C,j as He,k,B as Ne,q as Pe,l as Ue,m as Re,C as Oe,I as Ve,H as je,w as U,t as ze,T as R,G as O,v as Ke,n as qe,x as Ge,y as Je,z as Qe,A as We,D as Xe}from"./shared-extensionBookmarkStore.js";const Ye={class:"newtab-container min-h-screen flex flex-col bg-bg-primary text-text-primary"},Ze={key:0,class:"flex-1 flex items-center justify-center"},ea={class:"flex-1 flex items-start justify-center p-6 pb-20 pt-8"},aa={class:"flex items-start gap-8"},ta={class:"mb-4"},na={key:0,class:"flex flex-col gap-4"},oa={key:0,class:"fixed bottom-6 left-1/2 -translate-x-1/2 z-50 px-4 py-2 rounded-lg bg-bg-secondary ring-1 ring-neon-cyan/50 shadow-lg shadow-neon-cyan/20 text-sm text-text-primary"},la={__name:"NewTabApp",setup(ua){const a=De();Qe("bookmarkStore",a);const{activeBlocks:A,activeTab:d,activeTabId:j,sortedTabs:y,canAddTab:z,canDeleteTab:K,buffer:B,trash:S,trashBlockCount:ra,trashTabCount:q,tabs:G}=Me(a),{startDragFromBuffer:J,draggedFromBuffer:Q}=Je(),{copy:W,cut:X}=Ge(),{isEditMode:i}=Ke(),{highlightedCells:Y,config:x}=Ae({onTabSwitch:e=>{if(c.value||s.value||b.value||g.value||i.value)return;const t=y.value[e];t&&(a.setActiveTab(t.id),a.rememberActiveTab())},onCellSelect:async(e,t)=>{if(c.value||s.value||b.value||g.value||i.value)return;const h=A.value.find(P=>P.position.row===e&&P.position.col===t);h&&(await a.rememberActiveTab(),window.location.href=h.url)},getTabCount:()=>y.value.length}),F=l(!0),w=l(!1),c=l(!1),o=l(null),v=l(null),m=l(!1),s=l(!1),f=l({title:"",message:"",confirmText:"Подтвердить",danger:!1,onConfirm:()=>{}}),b=l(!1),g=l(!1),_=l(null),I=l(""),E=l(!1);let D=null;function Z(e){I.value=e,E.value=!0,D&&clearTimeout(D),D=setTimeout(()=>{E.value=!1},2e3)}const ee=qe(()=>({tabs:G.value,buffer:B.value,trash:S.value}));function M(){w.value=!0}function L(e){e.target&&e.target!==document&&e.target!==document.body&&(w.value=!0)}function $(){w.value=!0}Se(async()=>{await a.init(),F.value=!1,window.addEventListener("beforeunload",H),document.addEventListener("visibilitychange",N),document.addEventListener("click",M),document.addEventListener("focusin",L),window.addEventListener("focus",$)});function H(){a.flushPendingSaves()}function N(){document.visibilityState==="hidden"&&a.flushPendingSaves()}Fe(()=>{window.removeEventListener("beforeunload",H),document.removeEventListener("visibilitychange",N),document.removeEventListener("click",M),document.removeEventListener("focusin",L),window.removeEventListener("focus",$)});function ae(e){i.value&&(o.value=null,v.value=e,m.value=!1,c.value=!0)}async function te(e){i.value?(o.value=e,v.value=e.position,m.value=!1,c.value=!0):(await a.rememberActiveTab(),window.location.href=e.url)}function ne({block:e,tabId:t}){B.value.length>=12||a.moveToBuffer(t,e.id)}function oe({block:e,tabId:t}){a.deleteBlock(t,e.id)}function le({block:e}){a.rememberActiveTab(),Z(`Ссылка скопирована: ${e.title}`)}function se(e){o.value?m.value?a.updateBufferBlock(o.value.id,e):a.updateBlock(d.value.id,o.value.id,e):a.addBlock(d.value.id,v.value,e),c.value=!1,o.value=null,v.value=null,m.value=!1}function ie(){o.value&&(f.value={title:"Удалить закладку",message:`Вы уверены, что хотите удалить "${o.value.title}"?`,confirmText:"Удалить",danger:!0,onConfirm:()=>{m.value?a.deleteFromBuffer(o.value.id):a.deleteBlock(d.value.id,o.value.id),c.value=!1,s.value=!1,o.value=null,v.value=null,m.value=!1}},s.value=!0)}function ue(){c.value=!1,o.value=null,v.value=null,m.value=!1}function re(e){a.setActiveTab(e),a.rememberActiveTab()}function de(){const e=a.addTab();e&&(_.value=e.id)}function ce(){_.value=null}function fe({id:e,name:t}){a.updateTab(e,{name:t})}function ve(e){const t=y.value.find(h=>h.id===e);t&&(f.value={title:"Удалить вкладку",message:`Вы уверены, что хотите удалить "${t.name}"? Все закладки этой вкладки будут перемещены в корзину.`,confirmText:"Удалить",danger:!0,onConfirm:()=>{a.deleteTab(e),s.value=!1}},s.value=!0)}function me({fromIndex:e,toIndex:t}){a.reorderTabs(e,t)}function he(e){J(e)}function pe(e){d.value&&a.moveToBuffer(d.value.id,e.id)}function be(e){o.value=e,v.value=null,m.value=!0,c.value=!0}function ge({block:e}){W(e,null,!0)}function Te({block:e}){X(e,null,!0)}function ke({block:e}){a.deleteFromBuffer(e.id)}function ye({trashIndex:e}){a.restoreBlockToBuffer(e)}function we(e){Q.value?a.deleteFromBuffer(e.id):d.value&&a.deleteBlock(d.value.id,e.id)}function Ce(){f.value={title:"Очистить корзину",message:"Вы уверены, что хотите безвозвратно удалить все элементы из корзины? Это действие нельзя отменить.",confirmText:"Очистить",danger:!0,onConfirm:()=>{a.emptyTrash(),s.value=!1}},s.value=!0}function Be(){b.value=!0}function xe(e){a.importData(e)}function _e(){f.value={title:"Сбросить все данные",message:"Вы уверены, что хотите сбросить все данные? Все ваши закладки, вкладки и настройки будут удалены. Это действие нельзя отменить.",confirmText:"Сбросить всё",danger:!0,onConfirm:()=>{a.reset(),s.value=!1}},s.value=!0}return(e,t)=>(u(),p("div",Ye,[F.value?(u(),p("div",Ze,[...t[4]||(t[4]=[T("div",{class:"text-text-secondary"},"Загрузка...",-1)])])):(u(),p(Ie,{key:1},[r(Le,{onOpenImportExport:Be,onResetAll:_e,onOpenHelp:t[0]||(t[0]=h=>g.value=!0)}),T("main",ea,[T("div",aa,[T("div",null,[T("div",ta,[r($e,{tabs:n(y),"active-tab-id":n(j),"can-add-tab":n(z),"can-delete-tab":n(K),"edit-mode":n(i),"new-tab-id":_.value,"show-key-hints":n(x).showKeyHints&&!n(i),onSelect:re,onCreate:de,onUpdate:fe,onDelete:ve,onReorder:me,onEditComplete:ce},null,8,["tabs","active-tab-id","can-add-tab","can-delete-tab","edit-mode","new-tab-id","show-key-hints"])]),n(d)?(u(),C(He,{key:0,blocks:n(A),"tab-id":n(d).id,"edit-mode":n(i),"highlighted-cells":n(Y),"show-key-hints":n(x).showKeyHints&&!n(i),"key-hint-opacity":n(x).keyHintOpacity,onCellClick:ae,onBlockClick:te,onMoveToBuffer:ne,onMoveToTrash:oe,onUrlCopied:le},null,8,["blocks","tab-id","edit-mode","highlighted-cells","show-key-hints","key-hint-opacity"])):k("",!0)]),n(i)?(u(),p("div",na,[r(Ne,{blocks:n(B),onBlockDragStart:he,onDrop:pe,onDropFromTrash:ye,onBlockClick:be,onCopy:ge,onCut:Te,onMoveToTrash:ke},null,8,["blocks"]),r(Pe)])):k("",!0)])]),n(i)?(u(),C(Ue,{key:0,"trash-blocks":n(S).blocks,"trash-tab-count":n(q),onTrashDrop:we,onTrashEmpty:Ce},null,8,["trash-blocks","trash-tab-count"])):k("",!0),r(Re,{show:c.value,block:o.value,position:v.value,onSave:se,onDelete:ie,onCancel:ue},null,8,["show","block","position"]),r(Oe,{show:s.value,title:f.value.title,message:f.value.message,"confirm-text":f.value.confirmText,danger:f.value.danger,onConfirm:f.value.onConfirm,onCancel:t[1]||(t[1]=h=>s.value=!1)},null,8,["show","title","message","confirm-text","danger","onConfirm"]),r(Ve,{show:b.value,"current-data":ee.value,onClose:t[2]||(t[2]=h=>b.value=!1),onImport:xe},null,8,["show","current-data"]),r(je,{show:g.value,onClose:t[3]||(t[3]=h=>g.value=!1)},null,8,["show"]),(u(),C(O,{to:"body"},[r(R,{name:"toast"},{default:U(()=>[E.value?(u(),p("div",oa,ze(I.value),1)):k("",!0)]),_:1})])),(u(),C(O,{to:"body"},[r(R,{name:"hint"},{default:U(()=>[!w.value&&!n(i)?(u(),p("div",{key:0,class:"fixed top-20 left-1/2 -translate-x-1/2 z-[9999] px-5 py-2.5 rounded-lg bg-neon-cyan/10 ring-1 ring-neon-cyan/50 text-sm text-neon-cyan cursor-pointer hover:bg-neon-cyan/20 hover:ring-neon-cyan transition-all shadow-lg shadow-neon-cyan/10",onClick:M}," Кликните или нажмите Tab для активации клавиатуры ")):k("",!0)]),_:1})]))],64))]))}},sa=Ee(la,[["__scopeId","data-v-f0e3f2d4"]]),V=We(sa),ia=Xe();V.use(ia);V.mount("#app");
