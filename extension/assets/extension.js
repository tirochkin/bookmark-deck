import{_ as xe,u as _e,s as Ee,o as L,a as P,c as h,b,F as Me,d as r,e as De,f as o,g as Ae,h as U,i as Se,j as k,B as $e,k as Fe,l as Ie,C as Le,I as Pe,H as Ue,w as Re,T as He,r as l,m as Ne,n as v,p as Oe,t as Ve,q as je,v as ze,x as qe,y as Ke,z as Ge,A as Je}from"./shared-extensionBookmarkStore.js";const Qe={class:"extension-overlay min-h-screen flex flex-col bg-bg-primary text-text-primary"},We={key:0,class:"flex-1 flex items-center justify-center"},Xe={class:"flex-1 flex items-start justify-center p-4 pb-16 pt-4 overflow-auto"},Ye={class:"flex items-start gap-6"},Ze={class:"mb-3"},ea={key:0,class:"flex flex-col gap-3"},aa={key:0,class:"fixed bottom-4 left-1/2 -translate-x-1/2 z-50 px-4 py-2 rounded-lg bg-bg-secondary ring-1 ring-neon-cyan/50 shadow-lg shadow-neon-cyan/20 text-sm text-text-primary"},na={__name:"ExtensionApp",setup(la){const a=_e();Ke("bookmarkStore",a);const{activeBlocks:H,activeTab:i,activeTabId:N,sortedTabs:_,canAddTab:O,canDeleteTab:V,buffer:B,trash:E,trashBlockCount:sa,trashTabCount:j,tabs:z,isInitialized:ia}=Ee(a),{startDragFromBuffer:q,draggedFromBuffer:K}=qe(),{copy:G,cut:J}=ze(),{isEditMode:m}=je(),M=l(!0),d=l(!1),t=l(null),c=l(null),f=l(!1),s=l(!1),u=l({title:"",message:"",confirmText:"Подтвердить",danger:!1,onConfirm:()=>{}}),T=l(!1),g=l(!1),C=l(null),D=l(""),y=l(!1);let w=null;function Q(e){D.value=e,y.value=!0,w&&clearTimeout(w),w=setTimeout(()=>{y.value=!1},2e3)}const W=Ne(()=>({tabs:z.value,buffer:B.value,trash:E.value}));function x(e,n={}){window.parent.postMessage({action:e,data:n},"*")}function A(){a.flushPendingSaves(),x("close-overlay")}async function X(e){await a.rememberActiveTab(),x("open-url",{url:e})}async function Y(e){await a.rememberActiveTab(),x("copy-url",{url:e})}function S(e){const{action:n}=e.data||{}}function $(){document.visibilityState==="hidden"&&a.flushPendingSaves()}function F(){a.flushPendingSaves()}L(async()=>{window.addEventListener("message",S),window.addEventListener("beforeunload",F),document.addEventListener("visibilitychange",$),await a.init(),M.value=!1}),P(()=>{a.flushPendingSaves(),window.removeEventListener("message",S),window.removeEventListener("beforeunload",F),document.removeEventListener("visibilitychange",$)});function Z(e){m.value&&(t.value=null,c.value=e,f.value=!1,d.value=!0)}function ee(e){m.value?(t.value=e,c.value=e.position,f.value=!1,d.value=!0):X(e.url)}function ae({block:e,tabId:n}){B.value.length>=12||a.moveToBuffer(n,e.id)}function ne({block:e,tabId:n}){a.deleteBlock(n,e.id)}function te({block:e}){Q(`Ссылка скопирована: ${e.title}`),setTimeout(()=>{Y(e.url)},500)}function oe(e){t.value?f.value?a.updateBufferBlock(t.value.id,e):a.updateBlock(i.value.id,t.value.id,e):a.addBlock(i.value.id,c.value,e),d.value=!1,t.value=null,c.value=null,f.value=!1}function le(){t.value&&(u.value={title:"Удалить закладку",message:`Вы уверены, что хотите удалить "${t.value.title}"?`,confirmText:"Удалить",danger:!0,onConfirm:()=>{f.value?a.deleteFromBuffer(t.value.id):a.deleteBlock(i.value.id,t.value.id),d.value=!1,s.value=!1,t.value=null,c.value=null,f.value=!1}},s.value=!0)}function se(){d.value=!1,t.value=null,c.value=null,f.value=!1}function ie(e){a.setActiveTab(e),a.rememberActiveTab()}function ue(){const e=a.addTab();e&&(C.value=e.id)}function re(){C.value=null}function de({id:e,name:n}){a.updateTab(e,{name:n})}function ce(e){const n=_.value.find(p=>p.id===e);n&&(u.value={title:"Удалить вкладку",message:`Вы уверены, что хотите удалить "${n.name}"? Все закладки этой вкладки будут перемещены в корзину.`,confirmText:"Удалить",danger:!0,onConfirm:()=>{a.deleteTab(e),s.value=!1}},s.value=!0)}function fe({fromIndex:e,toIndex:n}){a.reorderTabs(e,n)}function ve(e){q(e)}function me(e){i.value&&a.moveToBuffer(i.value.id,e.id)}function pe(e){t.value=e,c.value=null,f.value=!0,d.value=!0}function he({block:e}){G(e,null,!0)}function be({block:e}){J(e,null,!0)}function Te({block:e}){a.deleteFromBuffer(e.id)}function ge({trashIndex:e}){a.restoreBlockToBuffer(e)}function ke(e){K.value?a.deleteFromBuffer(e.id):i.value&&a.deleteBlock(i.value.id,e.id)}function Be(){u.value={title:"Очистить корзину",message:"Вы уверены, что хотите безвозвратно удалить все элементы из корзины? Это действие нельзя отменить.",confirmText:"Очистить",danger:!0,onConfirm:()=>{a.emptyTrash(),s.value=!1}},s.value=!0}function Ce(){T.value=!0}function ye(e){a.importData(e)}function we(){u.value={title:"Сбросить все данные",message:"Вы уверены, что хотите сбросить все данные? Все ваши закладки, вкладки и настройки будут удалены. Это действие нельзя отменить.",confirmText:"Сбросить всё",danger:!0,onConfirm:()=>{a.reset(),s.value=!1}},s.value=!0}function I(e){e.key==="Escape"&&!d.value&&!s.value&&!T.value&&!g.value&&A()}return L(()=>{document.addEventListener("keydown",I)}),P(()=>{document.removeEventListener("keydown",I)}),(e,n)=>(v(),h("div",Qe,[M.value?(v(),h("div",We,[...n[4]||(n[4]=[b("div",{class:"text-text-secondary"},"Загрузка...",-1)])])):(v(),h(Me,{key:1},[r(De,{"is-extension":!0,onOpenImportExport:Ce,onResetAll:we,onOpenHelp:n[0]||(n[0]=p=>g.value=!0),onClose:A}),b("main",Xe,[b("div",Ye,[b("div",null,[b("div",Ze,[r(Ae,{tabs:o(_),"active-tab-id":o(N),"can-add-tab":o(O),"can-delete-tab":o(V),"edit-mode":o(m),"new-tab-id":C.value,onSelect:ie,onCreate:ue,onUpdate:de,onDelete:ce,onReorder:fe,onEditComplete:re},null,8,["tabs","active-tab-id","can-add-tab","can-delete-tab","edit-mode","new-tab-id"])]),o(i)?(v(),U(Se,{key:0,blocks:o(H),"tab-id":o(i).id,"edit-mode":o(m),onCellClick:Z,onBlockClick:ee,onMoveToBuffer:ae,onMoveToTrash:ne,onUrlCopied:te},null,8,["blocks","tab-id","edit-mode"])):k("",!0)]),o(m)?(v(),h("div",ea,[r($e,{blocks:o(B),onBlockDragStart:ve,onDrop:me,onDropFromTrash:ge,onBlockClick:pe,onCopy:he,onCut:be,onMoveToTrash:Te},null,8,["blocks"]),r(Oe)])):k("",!0)])]),o(m)?(v(),U(Fe,{key:0,"trash-blocks":o(E).blocks,"trash-tab-count":o(j),onTrashDrop:ke,onTrashEmpty:Be},null,8,["trash-blocks","trash-tab-count"])):k("",!0),r(Ie,{show:d.value,block:t.value,position:c.value,onSave:oe,onDelete:le,onCancel:se},null,8,["show","block","position"]),r(Le,{show:s.value,title:u.value.title,message:u.value.message,"confirm-text":u.value.confirmText,danger:u.value.danger,onConfirm:u.value.onConfirm,onCancel:n[1]||(n[1]=p=>s.value=!1)},null,8,["show","title","message","confirm-text","danger","onConfirm"]),r(Pe,{show:T.value,"current-data":W.value,onClose:n[2]||(n[2]=p=>T.value=!1),onImport:ye},null,8,["show","current-data"]),r(Ue,{show:g.value,onClose:n[3]||(n[3]=p=>g.value=!1)},null,8,["show"]),r(He,{name:"toast"},{default:Re(()=>[y.value?(v(),h("div",aa,Ve(D.value),1)):k("",!0)]),_:1})],64))]))}},ta=xe(na,[["__scopeId","data-v-f1c884da"]]),R=Ge(ta),oa=Je();R.use(oa);R.mount("#app");
