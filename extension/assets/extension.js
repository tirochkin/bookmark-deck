import{_ as we,u as _e,s as Ee,o as L,a as P,c as h,b,F as Me,d as r,e as De,f as o,g as Se,h as U,i as $e,j as B,B as Ae,k as Fe,l as Ie,C as Le,I as Pe,H as Ue,w as Re,T as He,r as l,m as Ne,n as v,p as Oe,t as Ve,q as je,v as ze,x as qe,y as Ke,z as Ge}from"./shared-extensionBookmarkStore.js";const Je={class:"extension-overlay min-h-screen flex flex-col bg-bg-primary text-text-primary"},Qe={key:0,class:"flex-1 flex items-center justify-center"},We={class:"flex-1 flex items-start justify-center p-4 pb-16 pt-4 overflow-auto"},Xe={class:"flex items-start gap-6"},Ye={class:"mb-3"},Ze={key:0,class:"flex flex-col gap-3"},ea={key:0,class:"fixed bottom-4 left-1/2 -translate-x-1/2 z-50 px-4 py-2 rounded-lg bg-bg-secondary ring-1 ring-neon-cyan/50 shadow-lg shadow-neon-cyan/20 text-sm text-text-primary"},aa={__name:"ExtensionApp",setup(oa){const a=_e(),{activeBlocks:H,activeTab:u,activeTabId:N,sortedTabs:_,canAddTab:O,canDeleteTab:V,buffer:C,trash:E,trashBlockCount:la,trashTabCount:j,tabs:z,isInitialized:sa}=Ee(a),{startDragFromBuffer:q,draggedFromBuffer:K}=qe(),{copy:G,cut:J}=ze(),{isEditMode:m}=je(),M=l(!0),d=l(!1),t=l(null),f=l(null),c=l(!1),s=l(!1),i=l({title:"",message:"",confirmText:"Подтвердить",danger:!1,onConfirm:()=>{}}),T=l(!1),g=l(!1),k=l(null),D=l(""),x=l(!1);let y=null;function Q(e){D.value=e,x.value=!0,y&&clearTimeout(y),y=setTimeout(()=>{x.value=!1},2e3)}const W=Ne(()=>({tabs:z.value,buffer:C.value,trash:E.value}));function w(e,n={}){window.parent.postMessage({action:e,data:n},"*")}function S(){a.flushPendingSaves(),w("close-overlay")}function X(e){w("open-url",{url:e})}function Y(e){w("copy-url",{url:e})}function $(e){const{action:n}=e.data||{}}function A(){document.visibilityState==="hidden"&&a.flushPendingSaves()}function F(){a.flushPendingSaves()}L(async()=>{window.addEventListener("message",$),window.addEventListener("beforeunload",F),document.addEventListener("visibilitychange",A),await a.init(),M.value=!1}),P(()=>{a.flushPendingSaves(),window.removeEventListener("message",$),window.removeEventListener("beforeunload",F),document.removeEventListener("visibilitychange",A)});function Z(e){m.value&&(t.value=null,f.value=e,c.value=!1,d.value=!0)}function ee(e){m.value?(t.value=e,f.value=e.position,c.value=!1,d.value=!0):X(e.url)}function ae({block:e,tabId:n}){C.value.length>=12||a.moveToBuffer(n,e.id)}function ne({block:e,tabId:n}){a.deleteBlock(n,e.id)}function te({block:e}){Q(`Ссылка скопирована: ${e.title}`),setTimeout(()=>{Y(e.url)},500)}function oe(e){t.value?c.value?a.updateBufferBlock(t.value.id,e):a.updateBlock(u.value.id,t.value.id,e):a.addBlock(u.value.id,f.value,e),d.value=!1,t.value=null,f.value=null,c.value=!1}function le(){t.value&&(i.value={title:"Удалить закладку",message:`Вы уверены, что хотите удалить "${t.value.title}"?`,confirmText:"Удалить",danger:!0,onConfirm:()=>{c.value?a.deleteFromBuffer(t.value.id):a.deleteBlock(u.value.id,t.value.id),d.value=!1,s.value=!1,t.value=null,f.value=null,c.value=!1}},s.value=!0)}function se(){d.value=!1,t.value=null,f.value=null,c.value=!1}function ue(e){a.setActiveTab(e)}function ie(){const e=a.addTab();e&&(k.value=e.id)}function re(){k.value=null}function de({id:e,name:n}){a.updateTab(e,{name:n})}function fe(e){const n=_.value.find(p=>p.id===e);n&&(i.value={title:"Удалить вкладку",message:`Вы уверены, что хотите удалить "${n.name}"? Все закладки этой вкладки будут перемещены в корзину.`,confirmText:"Удалить",danger:!0,onConfirm:()=>{a.deleteTab(e),s.value=!1}},s.value=!0)}function ce({fromIndex:e,toIndex:n}){a.reorderTabs(e,n)}function ve(e){q(e)}function me(e){u.value&&a.moveToBuffer(u.value.id,e.id)}function pe(e){t.value=e,f.value=null,c.value=!0,d.value=!0}function he({block:e}){G(e,null,!0)}function be({block:e}){J(e,null,!0)}function Te({block:e}){a.deleteFromBuffer(e.id)}function ge({trashIndex:e}){a.restoreBlockToBuffer(e)}function Be(e){K.value?a.deleteFromBuffer(e.id):u.value&&a.deleteBlock(u.value.id,e.id)}function Ce(){i.value={title:"Очистить корзину",message:"Вы уверены, что хотите безвозвратно удалить все элементы из корзины? Это действие нельзя отменить.",confirmText:"Очистить",danger:!0,onConfirm:()=>{a.emptyTrash(),s.value=!1}},s.value=!0}function ke(){T.value=!0}function xe(e){a.importData(e)}function ye(){i.value={title:"Сбросить все данные",message:"Вы уверены, что хотите сбросить все данные? Все ваши закладки, вкладки и настройки будут удалены. Это действие нельзя отменить.",confirmText:"Сбросить всё",danger:!0,onConfirm:()=>{a.reset(),s.value=!1}},s.value=!0}function I(e){e.key==="Escape"&&!d.value&&!s.value&&!T.value&&!g.value&&S()}return L(()=>{document.addEventListener("keydown",I)}),P(()=>{document.removeEventListener("keydown",I)}),(e,n)=>(v(),h("div",Je,[M.value?(v(),h("div",Qe,[...n[4]||(n[4]=[b("div",{class:"text-text-secondary"},"Загрузка...",-1)])])):(v(),h(Me,{key:1},[r(De,{"is-extension":!0,onOpenImportExport:ke,onResetAll:ye,onOpenHelp:n[0]||(n[0]=p=>g.value=!0),onClose:S}),b("main",We,[b("div",Xe,[b("div",null,[b("div",Ye,[r(Se,{tabs:o(_),"active-tab-id":o(N),"can-add-tab":o(O),"can-delete-tab":o(V),"edit-mode":o(m),"new-tab-id":k.value,onSelect:ue,onCreate:ie,onUpdate:de,onDelete:fe,onReorder:ce,onEditComplete:re},null,8,["tabs","active-tab-id","can-add-tab","can-delete-tab","edit-mode","new-tab-id"])]),o(u)?(v(),U($e,{key:0,blocks:o(H),"tab-id":o(u).id,"edit-mode":o(m),onCellClick:Z,onBlockClick:ee,onMoveToBuffer:ae,onMoveToTrash:ne,onUrlCopied:te},null,8,["blocks","tab-id","edit-mode"])):B("",!0)]),o(m)?(v(),h("div",Ze,[r(Ae,{blocks:o(C),onBlockDragStart:ve,onDrop:me,onDropFromTrash:ge,onBlockClick:pe,onCopy:he,onCut:be,onMoveToTrash:Te},null,8,["blocks"]),r(Oe)])):B("",!0)])]),o(m)?(v(),U(Fe,{key:0,"trash-blocks":o(E).blocks,"trash-tab-count":o(j),onTrashDrop:Be,onTrashEmpty:Ce},null,8,["trash-blocks","trash-tab-count"])):B("",!0),r(Ie,{show:d.value,block:t.value,position:f.value,onSave:oe,onDelete:le,onCancel:se},null,8,["show","block","position"]),r(Le,{show:s.value,title:i.value.title,message:i.value.message,"confirm-text":i.value.confirmText,danger:i.value.danger,onConfirm:i.value.onConfirm,onCancel:n[1]||(n[1]=p=>s.value=!1)},null,8,["show","title","message","confirm-text","danger","onConfirm"]),r(Pe,{show:T.value,"current-data":W.value,onClose:n[2]||(n[2]=p=>T.value=!1),onImport:xe},null,8,["show","current-data"]),r(Ue,{show:g.value,onClose:n[3]||(n[3]=p=>g.value=!1)},null,8,["show"]),r(He,{name:"toast"},{default:Re(()=>[x.value?(v(),h("div",ea,Ve(D.value),1)):B("",!0)]),_:1})],64))]))}},na=we(aa,[["__scopeId","data-v-c75a5eed"]]),R=Ke(na),ta=Ge();R.use(ta);R.mount("#app");
