import{_ as De,u as Ae,s as Se,a as $e,o as O,b as R,c as g,d as T,F as Fe,e as c,f as Ie,g as n,h as Le,i as K,j as Pe,k as y,B as Ue,l as He,m as Ne,C as Oe,I as Re,H as Ke,w as Ve,T as je,r as s,n as ze,p as h,q as qe,t as Ge,v as Je,x as Qe,y as We,z as Xe,A as Ye,D as Ze}from"./shared-extensionBookmarkStore.js";const ea={key:0,class:"flex-1 flex items-center justify-center"},aa={class:"flex-1 flex items-start justify-center p-4 pb-16 pt-4 overflow-auto"},ta={class:"flex items-start gap-6"},na={class:"mb-3"},oa={key:0,class:"flex flex-col gap-3"},la={key:0,class:"fixed bottom-4 left-1/2 -translate-x-1/2 z-50 px-4 py-2 rounded-lg bg-bg-secondary ring-1 ring-neon-cyan/50 shadow-lg shadow-neon-cyan/20 text-sm text-text-primary"},sa={__name:"ExtensionApp",setup(ra){const a=Ae();Xe("bookmarkStore",a);const{activeBlocks:M,activeTab:r,activeTabId:j,sortedTabs:k,canAddTab:z,canDeleteTab:q,buffer:C,trash:D,trashBlockCount:da,trashTabCount:G,tabs:J,isInitialized:ca}=Se(a),{startDragFromBuffer:Q,draggedFromBuffer:W}=We(),{copy:X,cut:Y}=Qe(),{isEditMode:i}=Je(),{highlightedCells:Z,config:w}=$e({onTabSwitch:e=>{if(u.value||l.value||p.value||b.value||i.value)return;const t=k.value[e];t&&(a.setActiveTab(t.id),a.rememberActiveTab())},onCellSelect:(e,t)=>{if(u.value||l.value||p.value||b.value||i.value)return;const m=M.value.find(N=>N.position.row===e&&N.position.col===t);m&&I(m.url)},getTabCount:()=>k.value.length}),A=s(!0),S=s(null),u=s(!1),o=s(null),f=s(null),v=s(!1),l=s(!1),d=s({title:"",message:"",confirmText:"Подтвердить",danger:!1,onConfirm:()=>{}}),p=s(!1),b=s(!1),B=s(null),$=s(""),x=s(!1);let _=null;function ee(e){$.value=e,x.value=!0,_&&clearTimeout(_),_=setTimeout(()=>{x.value=!1},2e3)}const ae=ze(()=>({tabs:J.value,buffer:C.value,trash:D.value}));function E(e,t={}){window.parent.postMessage({action:e,data:t},"*")}function F(){a.flushPendingSaves(),E("close-overlay")}async function I(e){await a.rememberActiveTab(),E("open-url",{url:e})}async function te(e){await a.rememberActiveTab(),E("copy-url",{url:e})}function L(e){const{action:t}=e.data||{}}function P(){document.visibilityState==="hidden"&&a.flushPendingSaves()}function U(){a.flushPendingSaves()}O(async()=>{window.addEventListener("message",L),window.addEventListener("beforeunload",U),document.addEventListener("visibilitychange",P),await a.init(),A.value=!1,setTimeout(()=>{S.value?.focus()},50)}),R(()=>{a.flushPendingSaves(),window.removeEventListener("message",L),window.removeEventListener("beforeunload",U),document.removeEventListener("visibilitychange",P)});function ne(e){i.value&&(o.value=null,f.value=e,v.value=!1,u.value=!0)}function oe(e){i.value?(o.value=e,f.value=e.position,v.value=!1,u.value=!0):I(e.url)}function le({block:e,tabId:t}){C.value.length>=12||a.moveToBuffer(t,e.id)}function se({block:e,tabId:t}){a.deleteBlock(t,e.id)}function ie({block:e}){ee(`Ссылка скопирована: ${e.title}`),setTimeout(()=>{te(e.url)},500)}function ue(e){o.value?v.value?a.updateBufferBlock(o.value.id,e):a.updateBlock(r.value.id,o.value.id,e):a.addBlock(r.value.id,f.value,e),u.value=!1,o.value=null,f.value=null,v.value=!1}function re(){o.value&&(d.value={title:"Удалить закладку",message:`Вы уверены, что хотите удалить "${o.value.title}"?`,confirmText:"Удалить",danger:!0,onConfirm:()=>{v.value?a.deleteFromBuffer(o.value.id):a.deleteBlock(r.value.id,o.value.id),u.value=!1,l.value=!1,o.value=null,f.value=null,v.value=!1}},l.value=!0)}function de(){u.value=!1,o.value=null,f.value=null,v.value=!1}function ce(e){a.setActiveTab(e),a.rememberActiveTab()}function fe(){const e=a.addTab();e&&(B.value=e.id)}function ve(){B.value=null}function me({id:e,name:t}){a.updateTab(e,{name:t})}function he(e){const t=k.value.find(m=>m.id===e);t&&(d.value={title:"Удалить вкладку",message:`Вы уверены, что хотите удалить "${t.name}"? Все закладки этой вкладки будут перемещены в корзину.`,confirmText:"Удалить",danger:!0,onConfirm:()=>{a.deleteTab(e),l.value=!1}},l.value=!0)}function pe({fromIndex:e,toIndex:t}){a.reorderTabs(e,t)}function be(e){Q(e)}function ge(e){r.value&&a.moveToBuffer(r.value.id,e.id)}function Te(e){o.value=e,f.value=null,v.value=!0,u.value=!0}function ke({block:e}){X(e,null,!0)}function ye({block:e}){Y(e,null,!0)}function Ce({block:e}){a.deleteFromBuffer(e.id)}function we({trashIndex:e}){a.restoreBlockToBuffer(e)}function Be(e){W.value?a.deleteFromBuffer(e.id):r.value&&a.deleteBlock(r.value.id,e.id)}function xe(){d.value={title:"Очистить корзину",message:"Вы уверены, что хотите безвозвратно удалить все элементы из корзины? Это действие нельзя отменить.",confirmText:"Очистить",danger:!0,onConfirm:()=>{a.emptyTrash(),l.value=!1}},l.value=!0}function _e(){p.value=!0}function Ee(e){a.importData(e)}function Me(){d.value={title:"Сбросить все данные",message:"Вы уверены, что хотите сбросить все данные? Все ваши закладки, вкладки и настройки будут удалены. Это действие нельзя отменить.",confirmText:"Сбросить всё",danger:!0,onConfirm:()=>{a.reset(),l.value=!1}},l.value=!0}function H(e){e.key==="Escape"&&!u.value&&!l.value&&!p.value&&!b.value&&F()}return O(()=>{document.addEventListener("keydown",H)}),R(()=>{document.removeEventListener("keydown",H)}),(e,t)=>(h(),g("div",{ref_key:"overlayContainer",ref:S,class:"extension-overlay min-h-screen flex flex-col bg-bg-primary text-text-primary",tabindex:"-1"},[A.value?(h(),g("div",ea,[...t[4]||(t[4]=[T("div",{class:"text-text-secondary"},"Загрузка...",-1)])])):(h(),g(Fe,{key:1},[c(Ie,{"is-extension":!0,onOpenImportExport:_e,onResetAll:Me,onOpenHelp:t[0]||(t[0]=m=>b.value=!0),onClose:F}),T("main",aa,[T("div",ta,[T("div",null,[T("div",na,[c(Le,{tabs:n(k),"active-tab-id":n(j),"can-add-tab":n(z),"can-delete-tab":n(q),"edit-mode":n(i),"new-tab-id":B.value,"show-key-hints":n(w).showKeyHints&&!n(i),onSelect:ce,onCreate:fe,onUpdate:me,onDelete:he,onReorder:pe,onEditComplete:ve},null,8,["tabs","active-tab-id","can-add-tab","can-delete-tab","edit-mode","new-tab-id","show-key-hints"])]),n(r)?(h(),K(Pe,{key:0,blocks:n(M),"tab-id":n(r).id,"edit-mode":n(i),"highlighted-cells":n(Z),"show-key-hints":n(w).showKeyHints&&!n(i),"key-hint-opacity":n(w).keyHintOpacity,onCellClick:ne,onBlockClick:oe,onMoveToBuffer:le,onMoveToTrash:se,onUrlCopied:ie},null,8,["blocks","tab-id","edit-mode","highlighted-cells","show-key-hints","key-hint-opacity"])):y("",!0)]),n(i)?(h(),g("div",oa,[c(Ue,{blocks:n(C),onBlockDragStart:be,onDrop:ge,onDropFromTrash:we,onBlockClick:Te,onCopy:ke,onCut:ye,onMoveToTrash:Ce},null,8,["blocks"]),c(qe)])):y("",!0)])]),n(i)?(h(),K(He,{key:0,"trash-blocks":n(D).blocks,"trash-tab-count":n(G),onTrashDrop:Be,onTrashEmpty:xe},null,8,["trash-blocks","trash-tab-count"])):y("",!0),c(Ne,{show:u.value,block:o.value,position:f.value,onSave:ue,onDelete:re,onCancel:de},null,8,["show","block","position"]),c(Oe,{show:l.value,title:d.value.title,message:d.value.message,"confirm-text":d.value.confirmText,danger:d.value.danger,onConfirm:d.value.onConfirm,onCancel:t[1]||(t[1]=m=>l.value=!1)},null,8,["show","title","message","confirm-text","danger","onConfirm"]),c(Re,{show:p.value,"current-data":ae.value,onClose:t[2]||(t[2]=m=>p.value=!1),onImport:Ee},null,8,["show","current-data"]),c(Ke,{show:b.value,onClose:t[3]||(t[3]=m=>b.value=!1)},null,8,["show"]),c(je,{name:"toast"},{default:Ve(()=>[x.value?(h(),g("div",la,Ge($.value),1)):y("",!0)]),_:1})],64))],512))}},ia=De(sa,[["__scopeId","data-v-6f534da9"]]),V=Ye(ia),ua=Ze();V.use(ua);V.mount("#app");
