import{_ as xe,u as ye,s as we,o as I,a as S,c as h,b as T,F as _e,d as i,e as Me,f as n,g as Ee,h as U,i as De,j as B,B as $e,k as Ae,l as Fe,C as Ie,I as Se,H as Ue,w as Le,T as Pe,r as l,m as Re,n as v,p as He,t as Ne,q as Oe,v as je,x as ze,y as Ve,z as qe}from"./shared-extensionBookmarkStore.js";const Ke={class:"extension-overlay min-h-screen flex flex-col bg-bg-primary text-text-primary"},Ge={key:0,class:"flex-1 flex items-center justify-center"},Je={class:"flex-1 flex items-start justify-center p-4 pb-16 pt-4 overflow-auto"},Qe={class:"flex items-start gap-6"},We={class:"mb-3"},Xe={key:0,class:"flex flex-col gap-3"},Ye={key:0,class:"fixed bottom-4 left-1/2 -translate-x-1/2 z-50 px-4 py-2 rounded-lg bg-bg-secondary ring-1 ring-neon-cyan/50 shadow-lg shadow-neon-cyan/20 text-sm text-text-primary"},Ze={__name:"ExtensionApp",setup(ta){const t=ye(),{activeBlocks:P,activeTab:u,activeTabId:R,sortedTabs:_,canAddTab:H,canDeleteTab:N,buffer:C,trash:M,trashBlockCount:oa,trashTabCount:O,tabs:j,isInitialized:na}=we(t),{startDragFromBuffer:z,draggedFromBuffer:V}=ze(),{copy:q,cut:K}=je(),{isEditMode:m}=Oe(),E=l(!0),d=l(!1),o=l(null),c=l(null),f=l(!1),s=l(!1),r=l({title:"",message:"",confirmText:"Подтвердить",danger:!1,onConfirm:()=>{}}),b=l(!1),k=l(!1),g=l(null),D=l(""),x=l(!1);let y=null;function G(e){D.value=e,x.value=!0,y&&clearTimeout(y),y=setTimeout(()=>{x.value=!1},2e3)}const J=Re(()=>({tabs:j.value,buffer:C.value,trash:M.value}));function w(e,a={}){window.parent.postMessage({action:e,data:a},"*")}function $(){w("close-overlay")}function Q(e){w("open-url",{url:e})}function W(e){w("copy-url",{url:e})}function A(e){const{action:a}=e.data||{}}I(async()=>{window.addEventListener("message",A),await t.init(),E.value=!1}),S(()=>{window.removeEventListener("message",A)});function X(e){m.value&&(o.value=null,c.value=e,f.value=!1,d.value=!0)}function Y(e){m.value?(o.value=e,c.value=e.position,f.value=!1,d.value=!0):Q(e.url)}function Z({block:e,tabId:a}){C.value.length>=12||t.moveToBuffer(a,e.id)}function ee({block:e,tabId:a}){t.deleteBlock(a,e.id)}function ae({block:e}){G(`Ссылка скопирована: ${e.title}`),setTimeout(()=>{W(e.url)},500)}function te(e){o.value?f.value?t.updateBufferBlock(o.value.id,e):t.updateBlock(u.value.id,o.value.id,e):t.addBlock(u.value.id,c.value,e),d.value=!1,o.value=null,c.value=null,f.value=!1}function oe(){o.value&&(r.value={title:"Удалить закладку",message:`Вы уверены, что хотите удалить "${o.value.title}"?`,confirmText:"Удалить",danger:!0,onConfirm:()=>{f.value?t.deleteFromBuffer(o.value.id):t.deleteBlock(u.value.id,o.value.id),d.value=!1,s.value=!1,o.value=null,c.value=null,f.value=!1}},s.value=!0)}function ne(){d.value=!1,o.value=null,c.value=null,f.value=!1}function le(e){t.setActiveTab(e)}function se(){const e=t.addTab();e&&(g.value=e.id)}function ue(){g.value=null}function re({id:e,name:a}){t.updateTab(e,{name:a})}function ie(e){const a=_.value.find(p=>p.id===e);a&&(r.value={title:"Удалить вкладку",message:`Вы уверены, что хотите удалить "${a.name}"? Все закладки этой вкладки будут перемещены в корзину.`,confirmText:"Удалить",danger:!0,onConfirm:()=>{t.deleteTab(e),s.value=!1}},s.value=!0)}function de({fromIndex:e,toIndex:a}){t.reorderTabs(e,a)}function ce(e){z(e)}function fe(e){u.value&&t.moveToBuffer(u.value.id,e.id)}function ve(e){o.value=e,c.value=null,f.value=!0,d.value=!0}function me({block:e}){q(e,null,!0)}function pe({block:e}){K(e,null,!0)}function he({block:e}){t.deleteFromBuffer(e.id)}function Te({trashIndex:e}){t.restoreBlockToBuffer(e)}function be(e){V.value?t.deleteFromBuffer(e.id):u.value&&t.deleteBlock(u.value.id,e.id)}function ke(){r.value={title:"Очистить корзину",message:"Вы уверены, что хотите безвозвратно удалить все элементы из корзины? Это действие нельзя отменить.",confirmText:"Очистить",danger:!0,onConfirm:()=>{t.emptyTrash(),s.value=!1}},s.value=!0}function Be(){b.value=!0}function Ce(e){t.importData(e)}function ge(){r.value={title:"Сбросить все данные",message:"Вы уверены, что хотите сбросить все данные? Все ваши закладки, вкладки и настройки будут удалены. Это действие нельзя отменить.",confirmText:"Сбросить всё",danger:!0,onConfirm:()=>{t.reset(),s.value=!1}},s.value=!0}function F(e){e.key==="Escape"&&!d.value&&!s.value&&!b.value&&!k.value&&$()}return I(()=>{document.addEventListener("keydown",F)}),S(()=>{document.removeEventListener("keydown",F)}),(e,a)=>(v(),h("div",Ke,[E.value?(v(),h("div",Ge,[...a[4]||(a[4]=[T("div",{class:"text-text-secondary"},"Загрузка...",-1)])])):(v(),h(_e,{key:1},[i(Me,{"is-extension":!0,onOpenImportExport:Be,onResetAll:ge,onOpenHelp:a[0]||(a[0]=p=>k.value=!0),onClose:$}),T("main",Je,[T("div",Qe,[T("div",null,[T("div",We,[i(Ee,{tabs:n(_),"active-tab-id":n(R),"can-add-tab":n(H),"can-delete-tab":n(N),"edit-mode":n(m),"new-tab-id":g.value,onSelect:le,onCreate:se,onUpdate:re,onDelete:ie,onReorder:de,onEditComplete:ue},null,8,["tabs","active-tab-id","can-add-tab","can-delete-tab","edit-mode","new-tab-id"])]),n(u)?(v(),U(De,{key:0,blocks:n(P),"tab-id":n(u).id,"edit-mode":n(m),onCellClick:X,onBlockClick:Y,onMoveToBuffer:Z,onMoveToTrash:ee,onUrlCopied:ae},null,8,["blocks","tab-id","edit-mode"])):B("",!0)]),n(m)?(v(),h("div",Xe,[i($e,{blocks:n(C),onBlockDragStart:ce,onDrop:fe,onDropFromTrash:Te,onBlockClick:ve,onCopy:me,onCut:pe,onMoveToTrash:he},null,8,["blocks"]),i(He)])):B("",!0)])]),n(m)?(v(),U(Ae,{key:0,"trash-blocks":n(M).blocks,"trash-tab-count":n(O),onTrashDrop:be,onTrashEmpty:ke},null,8,["trash-blocks","trash-tab-count"])):B("",!0),i(Fe,{show:d.value,block:o.value,position:c.value,onSave:te,onDelete:oe,onCancel:ne},null,8,["show","block","position"]),i(Ie,{show:s.value,title:r.value.title,message:r.value.message,"confirm-text":r.value.confirmText,danger:r.value.danger,onConfirm:r.value.onConfirm,onCancel:a[1]||(a[1]=p=>s.value=!1)},null,8,["show","title","message","confirm-text","danger","onConfirm"]),i(Se,{show:b.value,"current-data":J.value,onClose:a[2]||(a[2]=p=>b.value=!1),onImport:Ce},null,8,["show","current-data"]),i(Ue,{show:k.value,onClose:a[3]||(a[3]=p=>k.value=!1)},null,8,["show"]),i(Pe,{name:"toast"},{default:Le(()=>[x.value?(v(),h("div",Ye,Ne(D.value),1)):B("",!0)]),_:1})],64))]))}},ea=xe(Ze,[["__scopeId","data-v-9edd6083"]]),L=Ve(ea),aa=qe();L.use(aa);L.mount("#app");
