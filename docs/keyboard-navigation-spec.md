# Техническое задание: Клавиатурная навигация

## Общее описание

Реализовать навигацию по сетке ячеек (8×4) и табам (до 8) с помощью клавиатуры. Цель — доступ к любой ячейке максимум за 3 нажатия: таб → блок → ячейка.

---

## Функциональные требования

### 1. Переключение табов

- **Клавиши**: `1`, `2`, `3`, `4`, `5`, `6`, `7`, `8`
- **Поведение**: мгновенное переключение на соответствующий таб
- **Ограничение**: клавиша работает только если таб существует

### 2. Выбор ячейки (двухэтапный)

#### Этап 1: Выбор блока 2×2

Сетка делится на 8 блоков:

```
┌─────┬─────┬─────┬─────┐
│  Q  │  W  │  E  │  R  │  ← строки 1-2
├─────┼─────┼─────┼─────┤
│  A  │  S  │  D  │  F  │  ← строки 3-4
└─────┴─────┴─────┴─────┘
  1-2   3-4   5-6   7-8   ← колонки
```

#### Этап 2: Выбор ячейки внутри блока

Для верхних блоков (Q, W, E, R):
```
┌───┬───┐
│ Q │ W │
├───┼───┤
│ E │ R │
└───┴───┘
```

Для нижних блоков (A, S, D, F):
```
┌───┬───┐
│ A │ S │
├───┼───┤
│ D │ F │
└───┴───┘
```

#### Поведение

1. Нажатие клавиши блока (Q/W/E/R/A/S/D/F) активирует режим выбора ячейки
2. Следующее нажатие (Q/W/E/R или A/S/D/F соответственно) выбирает ячейку и выполняет переход по ссылке
3. Нажатие `Escape` или клавиши вне допустимых — отмена выбора блока

### 3. Таймаут выбора блока

- Если после выбора блока прошло более **1.5 секунды** без второго нажатия — сброс состояния
- Значение таймаута вынести в конфигурацию

---

## Интерфейс

### Подсказки клавиш на ячейках

- В углу каждой ячейки отображается двухбуквенное сочетание клавиш
- Стиль: ненавязчивый, приглушённый цвет (например, `rgba(255,255,255,0.4)` или `rgba(0,0,0,0.3)` в зависимости от темы)
- Размер шрифта: мелкий (10-12px)
- Позиция: левый верхний угол ячейки с небольшим отступом

Пример отображения:
```
┌──────────────┐
│ QQ           │
│              │
│   [иконка]   │
│   Название   │
└──────────────┘
```

### Подсветка при выборе блока

- После нажатия клавиши блока:
  - 4 ячейки выбранного блока визуально выделяются (лёгкая подсветка фона или рамка)
  - Остальные ячейки слегка затемняются (опционально)
  - Подсказки клавиш в активном блоке становятся более заметными

### Подсказки для табов

- Номер таба (1-8) отображается на каждом табе
- Стиль аналогичный подсказкам на ячейках

---

## Таблица соответствия клавиш и ячеек

| Комбинация | Колонка | Строка |
|------------|---------|--------|
| Q → Q      | 1 | 1 |
| Q → W      | 2 | 1 |
| Q → A      | 1 | 2 |
| Q → S      | 2 | 2 |
| W → W      | 3 | 1 |
| W → E      | 4 | 1 |
| W → S      | 3 | 2 |
| W → D      | 4 | 2 |
| E → E      | 5 | 1 |
| E → R      | 6 | 1 |
| E → D      | 5 | 2 |
| E → F      | 6 | 2 |
| R → R      | 7 | 1 |
| R → T      | 8 | 1 |
| R → F      | 7 | 2 |
| R → G      | 8 | 2 |
| A → A      | 1 | 3 |
| A → S      | 2 | 3 |
| A → Z      | 1 | 4 |
| A → X      | 2 | 4 |
| S → S      | 3 | 3 |
| S → D      | 4 | 3 |
| S → X      | 3 | 4 |
| S → C      | 4 | 4 |
| D → D      | 5 | 3 |
| D → F      | 6 | 3 |
| D → C      | 5 | 4 |
| D → V      | 6 | 4 |
| F → F      | 7 | 3 |
| F → G      | 8 | 3 |
| F → V      | 7 | 4 |
| F → B      | 8 | 4 |

---

## Состояния приложения

```
IDLE → (Q/W/E/R) → BLOCK_SELECTED_UPPER → (Q/W/E/R) → действие → IDLE
     → (A/S/D/F) → BLOCK_SELECTED_LOWER → (A/S/D/F) → действие → IDLE
     → (1-8)     → переключение таба → IDLE
     → (Escape)  → IDLE
```

---

## Обработка крайних случаев

1. **Пустая ячейка**: нажатие игнорируется, сброс состояния
2. **Фокус в поле ввода**: клавиатурная навигация отключена
3. **Несуществующий таб**: нажатие игнорируется
4. **Неверная клавиша после выбора блока**: сброс состояния

---

## Доступность (a11y)

- Добавить `aria-keyshortcuts` на ячейки и табы
- Поддержка screen reader: озвучивание текущего состояния при выборе блока

---

## Конфигурация

| Параметр | Значение по умолчанию | Описание |
|----------|----------------------|----------|
| `blockSelectionTimeout` | 1500 мс | Таймаут сброса выбора блока |
| `showKeyHints` | true | Отображение подсказок клавиш |
| `keyHintOpacity` | 0.4 | Прозрачность подсказок |
